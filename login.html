<!DOCTYPE html>
<html >
<head>
  <meta charset="UTF-8">
  <title>Flat Login Form</title>  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
  <link rel='stylesheet prefetch' href='http://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900'>
  <link rel='stylesheet prefetch' href='http://fonts.googleapis.com/css?family=Montserrat:400,700'>
  <link rel='stylesheet prefetch' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css'>
  <link rel="stylesheet" href="css/style.css">  
</head>

<body>  
<div class="container">
  <div class="info">
    <h2>Welcome to the Document Management App</h2>
    <span>Please log in to continue</a></span>
  </div>
</div>
<div class="form">
  <div class="thumbnail"><img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/169963/hat.svg"/></div>
    <input type="text" id="username" placeholder="username"/>
    <input type="password" id="password" placeholder="password"/>
    <button onclick="loginButtonClicked()">login</button>
</div>
  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>

    <script src="js/index.js"></script>

</body>
<script>

const kROLE_ADMIN = "ROLE_ADMIN"
const kROLE_CONTRIBUTOR = "ROLE_CONTRIBUTOR"
const kROLE_CITITOR = "ROLE_CITITOR"
const kROLE_MANAGER = "ROLE_MANAGER"

function loginButtonClicked() {
  var http = new XMLHttpRequest();
  var url = "http://localhost:8080/eppione/api/login";
  var username = $('#username').val();
  var password = $('#password').val();
  var params = "username=" + username + "&password=" + password;
  http.open("POST", url, true);

  //Send the proper header information along with the request
  http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

  http.onreadystatechange = function() {//Call a function when the state changes.
    if (http.readyState == 4 && http.status == 200) {

      // save the response as a string in sessionStorage
      sessionStorage.setItem("loginCredentials",JSON.stringify(http.responseText));
      let json = JSON.parse(http.responseText);

      role = json.roles[0].name;

        switch(role) {
          case kROLE_ADMIN:
            window.location.href = "http://localhost:8888/proiectColectivFront/admin.html"
          break;
          case kROLE_CONTRIBUTOR:
            window.location.href = "http://localhost:8888/proiectColectivFront/contributor.html"
          break;
          case kROLE_CITITOR:
            window.location.href = "http://localhost:8888/proiectColectivFront/reader.html"
          break;
          case kROLE_MANAGER:
            window.location.href = "http://localhost:8888/proiectColectivFront/manager.html"
          break;
          default:
          alert("undefined");
          }
    }
}
http.send(params);
}
</script>
</html>
